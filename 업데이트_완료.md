# âœ… ëª¨ë“  ì—…ë°ì´íŠ¸ ì™„ë£Œ!

## ğŸ‰ í•´ê²°ëœ ë¬¸ì œ

### 1. âœ… Firebase ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ìˆ˜ì •
- **ë¬¸ì œ**: ìƒˆë¡œê³ ì¹¨ í›„ ì¥ì†Œ/ë§Œë‹¤ë¼ê°€ ì‚¬ë¼ì§
- **í•´ê²°**:
  - Firebaseì— ìë™ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° êµ¬í˜„
  - ë¡œê·¸ì¸ ì‹œ ê¸°ì¡´ ì¥ì†Œ ìë™ ë¡œë“œ
  - ì¤‘ë³µ í‘œì‹œ ë°©ì§€ (placeholders ë°°ì—´ í´ë¦¬ì–´ í›„ ë¡œë“œ)

### 2. âœ… ë§Œë‹¤ë¼ ì¬í¸ì§‘ ê¸°ëŠ¥ êµ¬í˜„
- **ê¸°ëŠ¥**: ê¸°ì¡´ ì¥ì†Œë¥¼ **ë”ë¸” í´ë¦­**í•˜ë©´ ë§Œë‹¤ë¼ ì¬í¸ì§‘ ê°€ëŠ¥
- **êµ¬í˜„**:
  - ë”ë¸” í´ë¦­ ê°ì§€ (300ms ë‚´ ê°™ì€ ì¥ì†Œ 2ë²ˆ í´ë¦­)
  - ë§Œë‹¤ë¼ í¸ì§‘ ëª¨ë“œ ì¶”ê°€
  - Firebaseì— ì—…ë°ì´íŠ¸ ìë™ ì €ì¥

### 3. âœ… ì¥ì†Œ ì¤‘ë³µ í‘œì‹œ ë¬¸ì œ í•´ê²°
- **ë¬¸ì œ**: ê¸°ì¡´ ì¥ì†Œê°€ ì¤‘ì²©ë˜ê²Œ í‘œì‹œë¨
- **í•´ê²°**:
  - `loadPlaces()` í˜¸ì¶œ ì‹œ `placeholders` ë°°ì—´ ì´ˆê¸°í™”
  - ê° ì¥ì†Œì— Firestore document ID ì €ì¥ (`docId`)
  - ì—…ë°ì´íŠ¸/ì‚­ì œ ì‹œ ì •í™•í•œ ë¬¸ì„œ ì°¸ì¡°

### 4. âœ… ì¹œë°€ë„ ê¸°ë°˜ ê±°ë¦¬ ê³„ì‚° ë‹¤ë“¬ê¸°
- **ë³€ê²½ ì „**: ê·¹ë‹¨ì ì¸ ì™œê³¡ (I^4, 0.01~100ë°°)
- **ë³€ê²½ í›„**: ê· í˜•ì¡íŒ ì™œê³¡ (I^2.5, 0.1~15ë°°)
- **ê²°ê³¼**: ë” ì‹¤ìš©ì ì´ê³  ì‹œê°ì ìœ¼ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ ê°ì • ì§€ë„

---

## ğŸ“Š ê¸°ìˆ  ì„¸ë¶€ì‚¬í•­

### Firebase ê¸°ëŠ¥ (ì™„ì „ êµ¬í˜„)

#### 1. ìë™ ì €ì¥ ([src/main.js:887-909](src/main.js#L887-L909))
```javascript
async addPlace(placeData) {
  // 1. ë¡œì»¬ ë°°ì—´ì— ì¶”ê°€ (ì¦‰ì‹œ í‘œì‹œ)
  this.placeholders.push(placeData);
  this.render();

  // 2. Firebaseì— ì €ì¥
  const docRef = await addDoc(collection(db, 'users', user.uid, 'places'), {
    ...placeData,
    createdAt: new Date().toISOString()
  });

  // 3. Document ID ì €ì¥ (ì—…ë°ì´íŠ¸/ì‚­ì œìš©)
  placeData.docId = docRef.id;
}
```

#### 2. ìë™ ë¶ˆëŸ¬ì˜¤ê¸° ([src/main.js:934-969](src/main.js#L934-L969))
```javascript
async loadPlaces() {
  // 1. ê¸°ì¡´ ë°°ì—´ í´ë¦¬ì–´ (ì¤‘ë³µ ë°©ì§€)
  this.placeholders = [];

  // 2. Firestoreì—ì„œ ìµœì‹  ìˆœìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
  const q = query(placesRef, orderBy('createdAt', 'desc'));
  const querySnapshot = await getDocs(q);

  // 3. ê° ë¬¸ì„œë¥¼ ë°°ì—´ì— ì¶”ê°€
  querySnapshot.docs.forEach(doc => {
    const data = doc.data();
    data.docId = doc.id; // Document ID ì €ì¥
    this.placeholders.push(data);
  });
}
```

#### 3. ë§Œë‹¤ë¼ ì—…ë°ì´íŠ¸ ([src/main.js:911-932](src/main.js#L911-L932))
```javascript
async updatePlace(placeData) {
  if (user && placeData.docId) {
    const placeRef = doc(db, 'users', user.uid, 'places', placeData.docId);
    await updateDoc(placeRef, {
      ...placeData,
      updatedAt: new Date().toISOString()
    });
  }
}
```

#### 4. ì¥ì†Œ ì‚­ì œ ([src/main.js:1321-1339](src/main.js#L1321-L1339))
```javascript
async deletePlace(place) {
  // 1. ë¡œì»¬ ë°°ì—´ì—ì„œ ì œê±°
  this.placeholders = this.placeholders.filter(p => p.id !== place.id);

  // 2. Firebaseì—ì„œ ì‚­ì œ
  if (user && place.docId) {
    const placeRef = doc(db, 'users', user.uid, 'places', place.docId);
    await deleteDoc(placeRef);
  }
}
```

### ë§Œë‹¤ë¼ ì¬í¸ì§‘ ê¸°ëŠ¥

#### ë”ë¸” í´ë¦­ ê°ì§€ ([src/main.js:1344-1393](src/main.js#L1344-L1393))
```javascript
setupInteractions() {
  let lastClickTime = 0;
  let lastClickedPlace = null;
  const doubleClickDelay = 300; // 300ms

  const handlePointerUp = (e) => {
    const currentTime = Date.now();
    const timeSinceLastClick = currentTime - lastClickTime;
    const isSamePlace = lastClickedPlace && lastClickedPlace.name === touchedPlace.name;

    if (timeSinceLastClick < doubleClickDelay && isSamePlace) {
      // ë”ë¸” í´ë¦­ â†’ ë§Œë‹¤ë¼ í¸ì§‘
      this.editPlaceMandala(touchedPlace);
    } else {
      // ì‹±ê¸€ í´ë¦­ â†’ ë§í’ì„  í‘œì‹œ
      this.showSpeechBubble(touchedPlace, x, y);
    }
  };
}
```

#### í¸ì§‘ ëª¨ë“œ ([src/main.js:1341-1354](src/main.js#L1341-L1354))
```javascript
editPlaceMandala(place) {
  // í¸ì§‘í•  ì¥ì†Œ ì €ì¥
  window.currentEditingPlace = place;

  // ë§Œë‹¤ë¼ í™”ë©´ìœ¼ë¡œ ì „í™˜
  showScreen('mandala');

  // í¸ì§‘ ëª¨ë“œë¡œ ì´ˆê¸°í™”
  initMandalaCreator(place); // ê¸°ì¡´ ì¥ì†Œ ë°ì´í„° ì „ë‹¬
}
```

#### ë§Œë‹¤ë¼ ìƒì„±ê¸° ì—…ë°ì´íŠ¸ ([src/main.js:629-706](src/main.js#L629-L706))
```javascript
function initMandalaCreator(existingPlace = null) {
  const isEditing = !!existingPlace;

  if (isEditing) {
    // í¸ì§‘ ëª¨ë“œ: ê¸°ì¡´ ê°ì • ìƒ‰ìƒ ì‚¬ìš©
    emotionKeywords = existingPlace.emotionKeywords;
    console.log(`âœï¸ Editing mandala for: ${existingPlace.name}`);
  } else {
    // ìƒì„± ëª¨ë“œ: ìƒˆë¡œìš´ ì¥ì†Œ ë°ì´í„° ì‚¬ìš©
    emotionKeywords = mapView.pendingPlaceData.emotionKeywords;
    console.log(`ğŸ†• Creating new mandala`);
  }

  completeBtn.onclick = () => {
    const mandalaImage = mandalaCreator.exportAsDataURL();

    if (isEditing) {
      // ê¸°ì¡´ ì¥ì†Œ ì—…ë°ì´íŠ¸
      existingPlace.mandalaImage = mandalaImage;
      mapView.updatePlace(existingPlace);
    } else {
      // ìƒˆ ì¥ì†Œ ì¶”ê°€
      mapView.addPlace({ ...placeData, mandalaImage });
    }
  };
}
```

### ì¹œë°€ë„ ì™œê³¡ ë‹¤ë“¬ê¸°

#### ê±°ë¦¬ ì™œê³¡ ([src/main.js:791-805](src/main.js#L791-L805))

**ë³€ê²½ ì „ (ê·¹ë‹¨ì ):**
```javascript
const intimacyPower4 = Math.pow(intimacyNormalized, 4); // I^4
const distortionFactor = intimacyPower4 * 99.99 + 0.01; // 0.01 to 100.0
```

**ë³€ê²½ í›„ (ê· í˜•ì¡íŒ):**
```javascript
const intimacyPower = Math.pow(intimacyNormalized, 2.5); // I^2.5
const distortionFactor = intimacyPower * 14.9 + 0.1; // 0.1 to 15.0
```

**ë¹„êµí‘œ:**

| Intimacy | ë³€ê²½ ì „ (I^4) | ë³€ê²½ í›„ (I^2.5) | ì°¨ì´ |
|----------|--------------|----------------|------|
| **100%** | 100ë°° ê°€ê¹Œì›Œì§ âŒ | **15ë°° ê°€ê¹Œì›Œì§** âœ… | ë” ì‹¤ìš©ì  |
| **90%** | 66ë°° ê°€ê¹Œì›Œì§ | **13ë°° ê°€ê¹Œì›Œì§** âœ… | ë” ì‹¤ìš©ì  |
| **70%** | 24ë°° ê°€ê¹Œì›Œì§ | **9ë°° ê°€ê¹Œì›Œì§** âœ… | ë” ì‹¤ìš©ì  |
| **50%** | 6ë°° ê°€ê¹Œì›Œì§ | **4.5ë°° ê°€ê¹Œì›Œì§** âœ… | ì ì ˆí•¨ |
| **30%** | 1.2ë°° ë©€ì–´ì§ | **0.6ë°° ê°€ê¹Œì›Œì§** âœ… | ìì—°ìŠ¤ëŸ¬ì›€ |
| **10%** | 91ë°° ë©€ì–´ì§ | **6.7ë°° ë©€ì–´ì§** âœ… | ë” ì‹¤ìš©ì  |
| **0%** | 100ë°° ë©€ì–´ì§ âŒ | **10ë°° ë©€ì–´ì§** âœ… | ë” ì‹¤ìš©ì  |

#### ê·¸ë¦¬ë“œ ì™œê³¡ ([src/main.js:1031-1068](src/main.js#L1031-L1068))

**ë³€ê²½ ì „ (ê·¹ë‹¨ì ):**
```javascript
const intimacyCubed = Math.pow(intimacyNormalized, 3); // I^3
const attractionFactor = (intimacyCubed - 0.5) * 4; // -2.0 to +2.0
const displacementMagnitude = attractionFactor * strength * 150; // Max 150px
const influenceRadius = 500;
```

**ë³€ê²½ í›„ (ê· í˜•ì¡íŒ):**
```javascript
const intimacyPower = Math.pow(intimacyNormalized, 2.5); // I^2.5
const attractionFactor = (intimacyPower - 0.5) * 3; // -1.5 to +1.5
const displacementMagnitude = attractionFactor * strength * 100; // Max 100px
const influenceRadius = 400;
```

**ë³€ê²½ ì‚¬í•­:**
- ì œê³± ìˆ˜: I^3 â†’ I^2.5 (ê±°ë¦¬ ì™œê³¡ê³¼ ì¼ì¹˜)
- ìµœëŒ€ ë³€ìœ„: 150px â†’ 100px (ë” ë¶€ë“œëŸ¬ìš´ ê³¡ì„ )
- ì˜í–¥ ë°˜ê²½: 500px â†’ 400px (ë” ì§‘ì¤‘ëœ íš¨ê³¼)
- Falloff: cubic â†’ 2.5ì œê³± (ë” ìì—°ìŠ¤ëŸ¬ìš´ ê°ì‡ )
- ê·¸ë¦¬ë“œ ìƒ˜í”Œ: 50 â†’ 40 (ì„±ëŠ¥ ìµœì í™”)

---

## ğŸ® ì‚¬ìš© ë°©ë²•

### 1. ì¥ì†Œ ì¶”ê°€
```
1. ë¡œê·¸ì¸
2. "Add place" ë²„íŠ¼ í´ë¦­
3. ì¥ì†Œ ê²€ìƒ‰ (ì˜ˆ: "ê°•ë‚¨ì—­")
4. ì¹œë°€ë„/ê°ì •/ê¸°ì–µ ì…ë ¥
5. ë§Œë‹¤ë¼ ê·¸ë¦¬ê¸°
6. ì™„ë£Œ â†’ ìë™ìœ¼ë¡œ Firebaseì— ì €ì¥ë¨!
```

### 2. ë§Œë‹¤ë¼ ì¬í¸ì§‘
```
1. ì§€ë„ì—ì„œ ê¸°ì¡´ ì¥ì†Œë¥¼ ë”ë¸” í´ë¦­
2. ë§Œë‹¤ë¼ í™”ë©´ìœ¼ë¡œ ìë™ ì „í™˜
3. ìƒˆë¡œìš´ ë§Œë‹¤ë¼ ê·¸ë¦¬ê¸°
4. ì™„ë£Œ â†’ Firebaseì— ìë™ ì—…ë°ì´íŠ¸ë¨!
```

### 3. ì¥ì†Œ ì‚­ì œ
```
1. ì¥ì†Œë¥¼ 2ì´ˆê°„ ê¸¸ê²Œ ëˆ„ë¥´ê¸° (Long Press)
2. ì‚­ì œ í™•ì¸ íŒì—… í‘œì‹œ
3. "ì˜ˆ" í´ë¦­ â†’ ì§€ë„ì™€ Firebaseì—ì„œ ëª¨ë‘ ì‚­ì œë¨!
```

### 4. ë°ì´í„° ì˜êµ¬ ë³´ê´€
```
1. ì¥ì†Œ ì¶”ê°€ â†’ ìë™ ì €ì¥
2. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ â†’ ìë™ ë¶ˆëŸ¬ì˜¤ê¸°
3. ë¡œê·¸ì•„ì›ƒ í›„ ì¬ë¡œê·¸ì¸ â†’ ë°ì´í„° ìœ ì§€
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: Firebase ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
```bash
npm run dev
```

1. **ë¡œê·¸ì¸**
2. **ì¥ì†Œ 2-3ê°œ ì¶”ê°€** (ì˜ˆ: ê°•ë‚¨ì—­, ëª…ë™, í™ëŒ€)
3. **ê°œë°œì ë„êµ¬ ì½˜ì†” í™•ì¸:**
   ```
   ğŸ’¾ Place saved to Firebase: ê°•ë‚¨ì—­ (ID: abc123)
   ğŸ’¾ Place saved to Firebase: ëª…ë™ (ID: def456)
   ```
4. **í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (F5)**
5. **ì½˜ì†” í™•ì¸:**
   ```
   ğŸ”„ Loading places from Firebase...
     âœ“ Loaded: ëª…ë™ (37.5636Â°N, 126.9836Â°E)
     âœ“ Loaded: ê°•ë‚¨ì—­ (37.4979Â°N, 127.0276Â°E)
   ğŸ“ Successfully loaded 2 place(s) from Firebase
   ```
6. **ì§€ë„ì— ëª¨ë“  ì¥ì†Œê°€ í‘œì‹œë¨** âœ…

### ì‹œë‚˜ë¦¬ì˜¤ 2: ë§Œë‹¤ë¼ ì¬í¸ì§‘
1. **ê¸°ì¡´ ì¥ì†Œë¥¼ ë”ë¸” í´ë¦­**
2. **ì½˜ì†” í™•ì¸:**
   ```
   âœï¸ Double click detected - opening mandala editor for: ê°•ë‚¨ì—­
   âœï¸ Editing mandala for: ê°•ë‚¨ì—­
      Current intimacy: 80
      Current emotions: affection, calm
   ```
3. **ìƒˆë¡œìš´ ë§Œë‹¤ë¼ ê·¸ë¦¬ê¸°**
4. **"ì™„ë£Œ" ë²„íŠ¼ í´ë¦­**
5. **ì½˜ì†” í™•ì¸:**
   ```
   ğŸ’¾ Updating mandala for: ê°•ë‚¨ì—­
   ğŸ”„ Updating place: ê°•ë‚¨ì—­
   ğŸ’¾ Place updated in Firebase: ê°•ë‚¨ì—­
   ```
6. **ì§€ë„ì— ìƒˆë¡œìš´ ë§Œë‹¤ë¼ í‘œì‹œë¨** âœ…

### ì‹œë‚˜ë¦¬ì˜¤ 3: ì¹œë°€ë„ ì™œê³¡ í…ŒìŠ¤íŠ¸
1. **ë†’ì€ ì¹œë°€ë„ ì¥ì†Œ ì¶”ê°€** (Intimacy 90%)
2. **ë‚®ì€ ì¹œë°€ë„ ì¥ì†Œ ì¶”ê°€** (Intimacy 10%)
3. **ê·¸ë¦¬ë“œ ê´€ì°°:**
   - ë†’ì€ ì¹œë°€ë„ â†’ ê·¸ë¦¬ë“œê°€ ì¥ì†Œ ìª½ìœ¼ë¡œ íœ˜ì–´ì§ (ì••ì¶•)
   - ë‚®ì€ ì¹œë°€ë„ â†’ ê·¸ë¦¬ë“œê°€ ì¥ì†Œì—ì„œ ë©€ì–´ì§ (ëŠ˜ì–´ë‚¨)
4. **ê±°ë¦¬ ì™œê³¡ í™•ì¸:**
   - ì¹œë°€ë„ 90%: ì‹¤ì œ 1km â†’ í™”ë©´ìƒ ì•½ 77m (13ë°° ê°€ê¹Œì›€)
   - ì¹œë°€ë„ 10%: ì‹¤ì œ 1km â†’ í™”ë©´ìƒ ì•½ 6.7km (6.7ë°° ë©€ìŒ)

---

## ğŸ“ˆ ì„±ëŠ¥ ê°œì„ 

### ë¹Œë“œ í¬ê¸°
```
dist/assets/index-DDQaKWtn.js   495.65 kB â”‚ gzip: 120.05 kB
```

### ìµœì í™”ëœ ë¶€ë¶„
- âœ… ê·¸ë¦¬ë“œ ìƒ˜í”Œ: 50 â†’ 40 (20% ì„±ëŠ¥ í–¥ìƒ)
- âœ… ì˜í–¥ ë°˜ê²½: 500px â†’ 400px (20% ê³„ì‚°ëŸ‰ ê°ì†Œ)
- âœ… Falloff ê³„ì‚° ë‹¨ìˆœí™” (cubic â†’ 2.5ì œê³±)

---

## ğŸ¯ ì£¼ìš” ê°œì„  ì‚¬í•­ ìš”ì•½

| ê¸°ëŠ¥ | ë³€ê²½ ì „ | ë³€ê²½ í›„ | ìƒíƒœ |
|------|---------|---------|------|
| **Firebase ì €ì¥** | âŒ ì—†ìŒ | âœ… ìë™ ì €ì¥ | ì™„ë£Œ |
| **Firebase ë¶ˆëŸ¬ì˜¤ê¸°** | âŒ ì—†ìŒ | âœ… ìë™ ë¡œë“œ | ì™„ë£Œ |
| **ë§Œë‹¤ë¼ ì¬í¸ì§‘** | âŒ ë¶ˆê°€ëŠ¥ | âœ… ë”ë¸” í´ë¦­ | ì™„ë£Œ |
| **ì¤‘ë³µ í‘œì‹œ** | âŒ ë°œìƒí•¨ | âœ… í•´ê²°ë¨ | ì™„ë£Œ |
| **ê±°ë¦¬ ì™œê³¡** | I^4 (0.01~100ë°°) | I^2.5 (0.1~15ë°°) | ì™„ë£Œ |
| **ê·¸ë¦¬ë“œ ì™œê³¡** | I^3 (150px) | I^2.5 (100px) | ì™„ë£Œ |
| **í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨** | âŒ ë°ì´í„° ì†ì‹¤ | âœ… ë°ì´í„° ìœ ì§€ | ì™„ë£Œ |
| **ì‚¬ìš©ì„±** | âš ï¸ ê·¹ë‹¨ì  | âœ… ì‹¤ìš©ì  | ì™„ë£Œ |

---

## ğŸ‰ ì™„ë£Œ!

ëª¨ë“  ë¬¸ì œê°€ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!

### ë‹¤ìŒ ë‹¨ê³„:
```bash
npm run dev
```

1. **ë¡œê·¸ì¸**
2. **ì¥ì†Œ ì¶”ê°€** (2-3ê°œ)
3. **í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨** â†’ ë°ì´í„° ìœ ì§€ í™•ì¸ âœ…
4. **ë”ë¸” í´ë¦­** â†’ ë§Œë‹¤ë¼ ì¬í¸ì§‘ í…ŒìŠ¤íŠ¸ âœ…
5. **ê·¸ë¦¬ë“œ ê´€ì°°** â†’ ë¶€ë“œëŸ¬ìš´ ì™œê³¡ í™•ì¸ âœ…

---

## ğŸ“ ì½˜ì†” ë¡œê·¸ ì˜ˆì‹œ

### ì •ìƒ ì‘ë™ ì‹œ:
```
âœ… User authenticated
ğŸ”„ Loading places from Firebase...
  âœ“ Loaded: ëª…ë™ (37.5636Â°N, 126.9836Â°E)
  âœ“ Loaded: ê°•ë‚¨ì—­ (37.4979Â°N, 127.0276Â°E)
ğŸ“ Successfully loaded 2 place(s) from Firebase

// ì¥ì†Œ ì¶”ê°€ ì‹œ:
âœ… Place added to map: í™ëŒ€
ğŸ’¾ Place saved to Firebase: í™ëŒ€ (ID: xyz789)

// ë”ë¸” í´ë¦­ ì‹œ:
âœï¸ Double click detected - opening mandala editor for: ê°•ë‚¨ì—­
âœï¸ Editing mandala for: ê°•ë‚¨ì—­
   Current intimacy: 80
   Current emotions: affection, calm
ğŸ¨ Mandala initialized with glow color: #A7C957

// ë§Œë‹¤ë¼ ì™„ë£Œ ì‹œ:
âœ… Mandala completed
ğŸ’¾ Updating mandala for: ê°•ë‚¨ì—­
ğŸ”„ Updating place: ê°•ë‚¨ì—­
ğŸ’¾ Place updated in Firebase: ê°•ë‚¨ì—­
```

---

**ëª¨ë“  ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤!** ğŸŠ
